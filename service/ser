// ADD AT TOP (after CRITICAL_FIELDS definition):
const headerCache = REQUIRED_HEADERS.map(h => ({
  mappedHeader: h.mappedHeader,
  systemHeader: h.systemHeader,
  isCritical: CRITICAL_FIELDS.has(h.systemHeader),
  isDateField: h.systemHeader.toLowerCase().includes('date') || h.systemHeader.toLowerCase().includes('_mo')
}));

// CHANGE forEach to use headerCache:
headerCache.forEach(h => {
  let val = trimSpace(row[h.mappedHeader]);

  if (h.isDateField && val) {
    val = formatExcelDate(val);
  }

  if (h.isCritical && (!val || val === '')) {
    skipRow = true;
  }
  
  // ... rest stays same
});

// CHANGE: Only push rows with remarks
if (remarks.length > 0) {
  processedData.push({
    ...row,
    remarks: remarks.join(', ')
  });
}

// CHANGE: Batch size from 1000 to 5000
if (dbBuffer.length >= 5000) {
  // ... rest stays same
}
